<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Channel Subscribers</title>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css">
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
</head>
<body>
    <h1>Количество подписчиков на канале:</h1>
    <div id="output"></div>

    <script type="text/javascript">
        async function fetchSubscribers() {
            // Загрузка пакета beautifulsoup4 перед использованием
            await pyodide.loadPackage('beautifulsoup4');

            // Выполнение HTTP-запроса для получения данных
            const response = await fetch('https://t.me/hamster_kombat');
            const text = await response.text();
            return text;
        }

        fetchSubscribers().then(data => {
            // Передача данных в Python для дальнейшего анализа
            pyscript.write("html_content", data);
        });
    </script>

    <py-script>
        import asyncio
        from js import pyscript
        from bs4 import BeautifulSoup
        import micropip

        async def install_packages():
            await micropip.install("beautifulsoup4")

        async def extract_subscribers_count(html):
            soup = BeautifulSoup(html, 'html.parser')
            subscribers_info = soup.find('div', class_='tgme_page_extra')
            if subscribers_info:
                subscribers_text = subscribers_info.text.strip()
                if 'members' in subscribers_text:
                    subscribers_text = subscribers_text.split(' members')[0].replace(',', '')
                elif 'subscribers' in subscribers_text:
                    subscribers_text = subscribers_text.split(' subscribers')[0].replace(',', '')
                elif 'online' in subscribers_text:
                    subscribers_text = subscribers_text.split(' online')[0].replace(',', '')
                if ' ' in subscribers_text and all(c.isdigit() or c == ' ' for c in subscribers_text):
                    subscribers_text = subscribers_text.replace(' ', '')
                return int(subscribers_text)
            else:
                return "Информация о подписчиках не найдена."

        async def main():
            # Установка необходимых пакетов
            await install_packages()

            # Получение HTML контента из JavaScript
            html_content = Element("html_content").element.innerHTML
            count = await extract_subscribers_count(html_content)
            Element("output").element.innerHTML = f"<p>{count}</p>"

        # Запуск основной корутины
        asyncio.ensure_future(main())
    </py-script>
</body>
</html>


